@model Epsilon.Web.Models.ViewModels.Shared.AddressDetailsViewModel

@using Epsilon.Logic.Constants
@using Epsilon.Resources.Common
@using Epsilon.Resources.Web.Submission
@using Epsilon.Logic.Helpers.Interfaces
@using Epsilon.Logic.Constants.Enums
@using Epsilon.Logic.Constants.Interfaces
@using Epsilon.Logic.Services.Interfaces
@using Epsilon.Logic.Helpers

@{
    var countryVariantResourceHelper = DependencyResolver.Current.GetService<ICountryVariantResourceHelper>();
    var countryAddressFieldMetadata = DependencyResolver.Current.GetService<ICountryAddressFieldMetadata>();
    var countryService = DependencyResolver.Current.GetService<ICountryService>();
    
    var tmpEnumCountryId = EnumsHelper.CountryId.Parse(Model.CountryId);
    if (!tmpEnumCountryId.HasValue)
    {
        throw new Exception(String.Format("Uknown CountryId {0}.", Model.CountryId));
    }
    var enumCountryId = tmpEnumCountryId.Value;

    var fieldMetadata = countryAddressFieldMetadata.GetForCountry(enumCountryId);

    var countryVariantResources = countryVariantResourceHelper.GetVariantsForCountry(Model.CountryId,
        new List<string> {
                    CountryVariantResourceName.ADDRESS_LINE1,
                    CountryVariantResourceName.ADDRESS_LINE2,
                    CountryVariantResourceName.ADDRESS_LINE3,
                    CountryVariantResourceName.ADDRESS_LINE4,
                    CountryVariantResourceName.ADDRESS_LOCALITY,
                    CountryVariantResourceName.ADDRESS_REGION,
                    CountryVariantResourceName.ADDRESS_POSTCODE
        });
}

<dl class="dl-horizontal">
    @if (fieldMetadata.Line1.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_LINE1]
        </dt>
        <dd>
            @Model.Line1
        </dd>
    }

    @if (fieldMetadata.Line2.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_LINE2]
        </dt>
        <dd>
            @Model.Line2
        </dd>
    }

    @if (fieldMetadata.Line3.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_LINE3]
        </dt>
        <dd>
            @Model.Line3
        </dd>
    }


    @if (fieldMetadata.Line4.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_LINE4]
        </dt>
        <dd>
            @Model.Line4
        </dd>
    }

    @if (fieldMetadata.Locality.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_LOCALITY]
        </dt>
        <dd>
            @Model.Locality
        </dd>
    }

    @if (fieldMetadata.Region.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_REGION]
        </dt>
        <dd>
            @Model.Region
        </dd>
    }

    @if (fieldMetadata.Postcode.IsUsed)
    {
        <dt>
            @countryVariantResources[CountryVariantResourceName.ADDRESS_POSTCODE]
        </dt>
        <dd>
            @Model.Postcode
        </dd>
    }

    <dt>
        @CommonResources.Country
    </dt>
    <dd>
        @countryService.GetDisplayName(Model.CountryId)
    </dd>
</dl>

